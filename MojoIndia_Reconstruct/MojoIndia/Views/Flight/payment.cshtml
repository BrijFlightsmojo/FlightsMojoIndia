@model Core.Flight.FlightBookingRequest
@using Core;
@using Core.Flight;
@using Razorpay.Api;

@{
    ViewBag.Title = "Payment";
    Layout = "~/Views/Shared/_LayoutFlight.cshtml";
}
@section AdditionalMeta
{
    <title>Passenger Payment: Flightsmojo</title>
}
<style>
    #form .form-group label.error {
        color: #FB3A3A;
        display: inline-block;
        margin: 0px 0 0px 0px;
        padding: 0;
        text-align: left;
    }

    .payment-card::after {
        color: green;
        content: "✔";
        display: inline-block;
        font-size: 20px;
        position: relative;
        top: -2px;
        width: 0px;
        transition: width 0.2s ease-in 0s;
        overflow: hidden;
        border: 0;
    }

    .error-class {
        border: 1px dotted #f00 !important;
    }

    .help-block {
        display: block;
        margin-top: 5px;
        margin-bottom: 10px;
        color: #737373;
        background: #fffcdc;
        margin: 3px 0;
        clear: both;
    }

    .help-block, .error {
        color: #f00;
        padding-left: 10px;
        font-size: 12px;
    }

    .field-validation-error {
        color: #f00 !important;
    }
    .ResultProgressPopup .ResultProgressProgressBar{top: 50%;
    left: 50%;
    -ms-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);
    position: relative;
    
    width:25%;
    border-radius: 6px;
    background: #fff;
    padding: 15px;text-align: center;    height: 340px;}
    .bookinggif{width:100%; display:inline-block; padding-bottom:20px;}
    .bookinggif img{ width:50%; border:0;}
    .ResultProgressPopup .ResultProgressProgressBar p {font-size: 15px;font-weight: bold;}
    .confirm_progress{width:100%; float:left; padding-top:10px;}
    .confirm_progress p{ color:#000; line-height:25px;}

</style>

<section class="payment_main">

    <div class="container">
        <div class="row">

            <div class="">
                <div class="payment_Page_main">
                    <div class="mobpay_header"><i class="fa-solid fa-arrow-left"></i> Select a payment method</div>

                    <div class="col-md-8">
                        <div class="paspaymentMobile">
                            @foreach (var result in Model.flightResult)
                            {
                                var AirportFrom = Model.airport.Where(k => k.airportCode == result.FlightSegments.FirstOrDefault().Segments.FirstOrDefault().Origin).FirstOrDefault();
                                var AirportTo = Model.airport.Where(k => k.airportCode == result.FlightSegments.FirstOrDefault().Segments.LastOrDefault().Destination).FirstOrDefault();
                                var airline = Model.airline.Where(k => k.code == result.FlightSegments.FirstOrDefault().Segments.FirstOrDefault().Airline).FirstOrDefault();

                                <div class="outbond_passenger">
                                    <div class="paymentMobile_left"><span class="passFlight"><img src="/images/flight_small/@(airline.code).gif" /></span></div>
                                    <div class="paymentMobile_right">
                                        <span class="passFlightName">@(AirportFrom.cityName ) </span>
                                        <span class="passFlighticon"><i class="fa-sharp fa-solid fa-plane"></i></span>
                                        <span class="passFlightName">@(AirportTo.cityName)</span>
                                    </div>
                                    <p>@(result.FlightSegments.FirstOrDefault().Segments.FirstOrDefault().DepTime.ToString("ddd- dd MMM yyyy")) </p>
                                </div>
                            }

                            <div class="peymentPasNam">
                                <i class="fa-solid fa-user"></i>
                                <span>
                                    @(Model.passengerDetails.FirstOrDefault().title + " " + Model.passengerDetails.FirstOrDefault().firstName + " " + Model.passengerDetails.FirstOrDefault().middleName + " " + Model.passengerDetails.FirstOrDefault().lastName + " " + (Model.passengerDetails.FirstOrDefault().passengerType != PassengerType.Adult ? Model.passengerDetails.FirstOrDefault().dateOfBirth.ToString("dd MMM yy") : ""))
                                </span>
                                @if (Model.passengerDetails.Count >= 2)
                                {
                                    <font>*</font>
                                    <span>@(Model.passengerDetails.Count - 1)</span>
                                }

                            </div>
                            
                            <div class="mobilepayble">
                                <span class="payableleft">Amount Payable</span><span class="payableright">₹<span id="totMobile"></span></span>
                            </div>
                        </div>
                        <div class="payment_Timer">
                            <i class="fa fa-clock-o"></i><span class="countdown"></span>
                        </div>
                        <div class="gray_pay">
                            <h3 class="payI">Review Details <i class="fa-solid fa-chevron-down "></i></h3>
                            <div class="pament_whiteCon mobnon">


                                <div class="payment_It" style="display:none;">

                                    @if (Model.flightResult[0].Fare.FareType == Core.FareType.INSTANTPUR || Model.flightResult[0].Fare.FareType == Core.FareType.INST_SERIESPUR || Model.flightResult[0].Fare.FareType == Core.FareType.OFFER_FARE_WITHOUT_PNR || Model.flightResult[0].Fare.FareType == Core.FareType.OFFER_FARE_WITH_PNR || Model.flightResult[0].Fare.FareType == Core.FareType.OFFER_RETURN_FARE_WITHOUT_PNR)
                                    {
                                        <div class="payment_term">
                                            <h6>Ticket is Non Refundable and Non Cancellable.</h6>
                                        </div>
                                    }
                                    <div class="payment_div2">
                                        <h3><i class="fa-regular fa-id-card"></i> Contact Information</h3>
                                        <div class="passdata">
                                            <div class="col-md-6 col-xs-12">
                                                <div class="passdata_show">
                                                    <span><i class="fa fa-envelope"></i>Email:</span><label>@Model.emailID</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-xs-12">
                                                <div class="passdata_show">
                                                    <span><i class="fa fa-phone"></i>Phone No:</span><label>@Model.phoneNo</label>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="payment_div2">
                                        <h3><i class="fa-regular fa-id-card"></i> Travellers Details</h3>
                                        <div class="passdata">


                                            <div class="col-md-12 col-xs-12">
                                                <div class="passdata_show">
                                                    <span class="webcheck">
                                                        <i class="fa fa-user"></i>
                                                        @(Model.passengerDetails.FirstOrDefault().title + " " + Model.passengerDetails.FirstOrDefault().firstName + " " + Model.passengerDetails.FirstOrDefault().middleName + " " + Model.passengerDetails.FirstOrDefault().lastName + " " + (Model.passengerDetails.FirstOrDefault().passengerType != PassengerType.Adult ? Model.passengerDetails.FirstOrDefault().dateOfBirth.ToString("dd MMM yy") : ""))
                                                    </span>
                                                    @if (Model.passengerDetails.Count >= 2)
                                                    {
                                                        <font>*</font>
                                                        <span>@(Model.passengerDetails.Count - 1)</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="payItenary">
                                        @{ int fsegCtr = 0; }

                                        @foreach (var result in Model.flightResult)
                                        {
                                            foreach (var fs in result.FlightSegments)

                                            {
                                                <span class="depat_img">
                                                    <i class="fa-solid fa-plane-departure"></i>
                                                    @if (fsegCtr == 0)
                                                    {
                                                        <span>Depart</span>
                                                    }
                                                    else
                                                    {
                                                        <span>Return</span>
                                                    }
                                                </span>
                                                foreach (var seg in fs.Segments)
                                                {
                                                    var AirportFrom = Model.airport.Where(k => k.airportCode == seg.Origin).FirstOrDefault();
                                                    var AirportTo = Model.airport.Where(k => k.airportCode == seg.Destination).FirstOrDefault();
                                                    var airline = Model.airline.Where(k => k.code == seg.Airline).FirstOrDefault();
                                                    <div class="passenger_Deapart">
                                                        <div class="depart_top">
                                                            <span class="passentCity">@(AirportFrom.cityName + "(" + AirportFrom.airportCode + ") - " + AirportTo.cityName + "(" + AirportTo.airportCode + ")")</span>
                                                            <font>|</font>
                                                            <span class="passengerDate">@(seg.DepTime.ToString("ddd- dd MMM yyyy"))</span>
                                                        </div>
                                                        <div class="passDepartMid">
                                                            <div class="passDepartLeft">
                                                                <div class="passDeapartM">
                                                                    <div class="passDepartLogo">
                                                                        <img src="/images/flight_small/@(airline.code).gif" />
                                                                    </div>
                                                                    <div class="passDepartAir">
                                                                        <span>@airline.name</span>
                                                                        <p>@airline.code</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="passDepartRight">
                                                                <div class="passDepartOne">
                                                                    <p><b>@(AirportFrom.airportCode)</b><span>@(seg.DepTime.ToString("hh:mm"))</span></p>
                                                                    <dfn>@(seg.DepTime.ToString("ddd, dd MMM"))</dfn>
                                                                    <span> @(AirportFrom.airportName)</span>
                                                                </div>
                                                                <div class="passDepartTwo pr">
                                                                    <div class="passDeartStop">
                                                                        <span>
                                                                            @(seg.Duration > 0 ? ((seg.Duration / 60) + "hr " + (seg.Duration % 60) + "min") : "Non Stop")
                                                                        </span>
                                                                    </div>
                                                                    <div class="passDSline"><span class="passIcon"></span></div>
                                                                    <div class="clearfix"></div>
                                                                    <div class="PassReundale">
                                                                        <span>NON REFUNDABLE</span>
                                                                    </div>
                                                                </div>
                                                                <div class="passDepartThird">
                                                                    <p><b>@(AirportTo.airportCode)</b><span>@(seg.ArrTime.ToString("hh:mm"))</span></p>
                                                                    <dfn>@(seg.ArrTime.ToString("ddd, dd MMM"))</dfn>
                                                                    <span>@AirportTo.airportName</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                            fsegCtr++;
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>      
                        <div class="pament_whiteCon">
                            <div class="payment_type">
                                <p>CHOOSE PAYMENT METHOD</p>
                                <h1>
                                    ₹
                                    <span id="totA"></span>
                                </h1>
                                <span class="ssl_payment"><i class="fa-solid fa-lock"></i> SSL Secure Payment</span>
                                <span id="CFee" style="display:none; font-size:12px;"> ₹ @(300 * Model.passengerDetails.Count * Model.flightResult.Count) non-refundable convenience fee is added.</span>
                                <span id="CFeeUPI" style="display:none; font-size:12px;"> ₹ @(150 * Model.passengerDetails.Count * Model.flightResult.Count) non-refundable convenience fee is added.</span>
                                <span id="CFeeSS" style="display:none; font-size:12px;"> ₹ @(0 * Model.passengerDetails.Count * Model.flightResult.Count) non-refundable convenience fee is added.</span>

                            </div>
                            <div class="paymenttymob"><i class="fa-regular fa-credit-card"></i> Payment Options</div>
                            <div class="paymenttype_bottom">

                                <div class="payment">
                                    <div class="payment-image"><img src="/images/upi_icon.png" alt="upi" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="upi" id="upi" checked="checked">
                                    <label class="payment-label is-maestro" for="upi">UPI</label>
                                </div>

                                <div class="payment">
                                    <div class="payment-image"><img src="~/images/payment_icon.png" alt="card" width="30"></div>
                                    <input class="payment-card" type="radio" value="card" name="payment" id="card">
                                    <label class="payment-label is-maestro" for="card">Debit & Credit Card</label>
                                </div>

                                <div class="payment">
                                    <div class="payment-image"><img src="~/images/netbank_icon.png" alt="netbanking" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="netbanking" id="netbanking">
                                    <label class="payment-label is-maestro" for="netbanking">Netbanking </label>@*<span>(Zero Convenience Fees)</span>*@
                                </div>

                                <div class="payment">
                                    <div class="payment-image"><img src="~/images/wallet_icon.png" alt="wallet" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="wallet" id="payment-wallet">
                                    <label class="payment-label is-maestro" for="payment-wallet">Wallet</label>
                                </div>

                                <div class="payment">
                                    <div class="payment-image"><img src="~/images/payment_icon.png" alt="emi" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="emi" id="payment-emi">
                                    <label class="payment-label is-maestro" for="payment-emi">Debit & Credit Card EMI</label>
                                </div>

                                <!--<div class="payment">
                                    <div class="payment-image"><img src="~/images/paylater_icon.png" alt="paylater" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="paylater" id="payment-paylater">
                                    <label class="payment-label is-maestro" for="payment-paylater">Pay Later</label>
                                </div>

                                <div class="payment">
                                    <div class="payment-image"><img src="~/images/cardeless_icon.png" alt="cardless_emi" width="30"></div>
                                    <input class="payment-card" type="radio" name="payment" value="cardless_emi" id="payment-cardless_emi">
                                    <label class="payment-label is-maestro" for="payment-cardless_emi">Cardless EMI</label>
                                </div>-->
                                @if (Model.flightResult.Exists(o => (o.Fare.FareType == FareType.OFFER_FARE_WITHOUT_PNR || o.Fare.FareType == FareType.OFFER_FARE_WITH_PNR ||o.Fare.FareType==FareType.OFFER_RETURN_FARE_WITHOUT_PNR || o.Fare.FareType == FareType.INSTANTPUR || o.Fare.FareType == FareType.INST_SERIESPUR)))
                                {
                                    <button type="submit" class="payment-button" id="btnSubmit_offer_fare" onclick="return ShowGroupFare();">Pay Now</button>
                                }
                                else
                                {
                                   <button type="submit" class="payment-button" id="btnSubmitPay" onclick="return payOnline();">Pay Now </button>
                                }

                            </div>

                            <div class="step-body">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="price-section">
                            <h3>Price Details</h3>
                            <div class="pricing">
                                <div class="price-row">
                                    <label class="psen-name">@Model.adults Traveler(s) : Adult</label>
                                    <label class="rate-amount">₹ @(((Model.sumFare.fareBreakdown.Where(k => k.PassengerType == PassengerType.Adult).First().BaseFare) * Model.adults).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))</label>
                                </div>
                                @if (Model.child > 0)
                                {
                                    <div class="price-row">
                                        <label class="psen-name">@Model.child Traveler(s) : Child</label>
                                        <label class="rate-amount">₹@(((Model.sumFare.fareBreakdown.Where(k => k.PassengerType == PassengerType.Child).First().BaseFare) * Model.child).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))</label>
                                    </div>
                                }
                                @if (Model.infants > 0)
                                {
                                    <div class="price-row">
                                        <label class="psen-name">@Model.infants Traveler(s) : infants</label>
                                        <label class="rate-amount">₹@(((Model.sumFare.fareBreakdown.Where(k => k.PassengerType == PassengerType.Infant).First().BaseFare) * Model.infants).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))</label>
                                    </div>
                                }

                                <div class="price-row">
                                    <label class="psen-namehead">Fee &amp; Surcharge</label>
                                    <label class="rate-amounthead">
                                        ₹
                                        @if (Model.flightResult.FirstOrDefault().FlightSegments.FirstOrDefault().Segments.FirstOrDefault().Airline == "UK")
                                        {
                                            if (Model.sourceMedia == "1000" || Model.sourceMedia == "1016" || Model.sourceMedia == "1004")
                                            {
                                                @(((Model.sumFare.Tax + Model.sumFare.Markup + Model.fareIncreaseAmount + Model.sumFare.ServiceFee + Model.sumFare.OtherCharges + Model.CouponIncreaseAmount-Model.sumFare.CommissionEarned)).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))
                                            }
                                            else
                                            {
                                                @(((Model.sumFare.Tax + Model.sumFare.Markup + Model.fareIncreaseAmount + Model.sumFare.ServiceFee + Model.sumFare.OtherCharges - Model.sumFare.CommissionEarned)).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))
                                            }

                                        }
                                        else
                                        {
                                            if (Model.sourceMedia == "1000" || Model.sourceMedia == "1016" || Model.sourceMedia == "1004")
                                            {
                                                @(((Model.sumFare.Tax + Model.sumFare.Markup + Model.fareIncreaseAmount + Model.sumFare.ServiceFee + Model.sumFare.OtherCharges + Model.CouponIncreaseAmount)).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))
                                            }
                                            else
                                            {
                                                @(((Model.sumFare.Tax + Model.sumFare.Markup + Model.fareIncreaseAmount + Model.sumFare.ServiceFee + Model.sumFare.OtherCharges)).ToString("0,0", new System.Globalization.CultureInfo("HI-in")))
                                            }
                                        }



                                        

                                            
                                    </label>
                                </div>
                                <div class="price-row" id="CouponPriceDetails" style="display:@(Model.CouponAmount>0?"block":"none");">
                                    <label class="psen-namehead">Coupon Discount</label>
                                    <label class="rate-amounthead">
                                        ₹<span id="CouponAmt">-@Model.CouponIncreaseAmount.ToString("0,0", new System.Globalization.CultureInfo("HI-in"))</span>
                                    </label>
                                </div>
                                <div class="price-row" style="display:none;" id="ConvenienceFee">
                                    <label class="psen-namehead">Convenience fee</label>
                                    <label class="rate-amounthead">₹ @(300 * Model.passengerDetails.Count * Model.flightResult.Count)</label>
                                </div>

                                <div class="price-row" style="display:none;" id="ConvenienceFeeUPI">
                                    <label class="psen-namehead">Convenience fee</label>
                                    <label class="rate-amounthead">₹ @(150 * Model.passengerDetails.Count * Model.flightResult.Count)</label>
                                </div>

                                <div class="coupn-section">
                                    <h4>
                                        Final Total Price: <em id="totalAmount1">
                                        </em><em>
                                            ₹
                                            <span id="tot"></span>
                                        </em>
                                    </h4>

                                </div>
                            </div>

                        </div>
                        
                        <div class="payment_iconDiv">
                            <h6>Trusted by more than 200,000 teams globally.</h6>
                            <div class="paymetImg"><img src="/images/secure_payment.png" /></div>
                            <h6>We accept the following cards</h6>
                            <div class="paymetImg"><img src="~/images/payment-card.png" /></div>
                            <input type="hidden" id="conveniencefee" name="conveniencefee" value="@(300 * Model.passengerDetails.Count * Model.flightResult.Count)" />
                            <input type="hidden" id="conveniencefeeUPI" name="conveniencefeeUPI" value="@(150 * Model.passengerDetails.Count * Model.flightResult.Count)" />
                            
@if (Model.sourceMedia == "1000" || Model.sourceMedia == "1016" || Model.sourceMedia == "1004")
{
    <input type="hidden" id="hftotalAmt" value="@(((Model.sumFare.grandTotal+Model.fareIncreaseAmount+ Model.CouponIncreaseAmount) - Model.CouponAmount).ToString("f2"))" />
}
else
{
    <input type="hidden" id="hftotalAmt" value="@(((Model.sumFare.grandTotal+Model.fareIncreaseAmount ) - Model.CouponAmount).ToString("f2"))" />
}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form id="Payment" action="/flight/Payment/" method="post">
        <input type="hidden" id="paymentid" name="paymentid" value="" />
        <input type="hidden" id="signature" name="signature" value="" />
        <input type="hidden" id="orderID" name="orderID" value="" />
        <input type="hidden" id="searchID" name="searchID" value="" />
    </form>
</section>
<div id="ResultProgressPopup" class="ResultProgressPopup" style="display:none;">
    <div class="ResultProgressProgressBar">
        <div class="bookinggif">
            <img src="/images/476.gif"/>
        </div>
        <div class="confirm_progress">
            <p style="font-size:13px;">Please wait while your booking is being processed.</p>
            <p style="font-size:13px;">Your Booking ID is @Model.bookingID</p>
        </div>
        @*<p> Call Now </p>
        <a href="tel:@GlobalData.Phone"><dfn></dfn> @GlobalData.Phone</a>*@
    </div>
</div>
<div class="cover" style="display:none;" id="GrpFare">
    <div class="contents">
        <h1>Exclusive Group Deal</h1>
        <a class="close_group" onclick="close();"></a>
        <div class="Group_Trip">
            @{
                var AirportFromGF = Core.FlightUtility.GetAirport(Model.flightResult.FirstOrDefault().FlightSegments.FirstOrDefault().Segments.FirstOrDefault().Origin);
                var AirportToGF = Core.FlightUtility.GetAirport(Model.flightResult.FirstOrDefault().FlightSegments.FirstOrDefault().Segments.LastOrDefault().Destination);
            }
            <div class="grouptrip_top">
                <img src="/images/like.svg" />
                <p>Important Notes for an exclusive deal!</p>
            </div>
            <ol>
                <li><b>&bull;</b><p>A booking confirmation will take a minimum of 30 to 45 Minutes.</p></li>
                <li><b>&bull;</b><p>Seats are subject to availability, In case of non-availability of the seats, We will refund the full amount.</p></li>
                <li><b>&bull;</b><p><strong>This exclusive deal is 100% Non-Refundable, Non-Changeable & Non-Cancellable.</strong></p></li>
                <li><b>&bull;</b><p><strong>You will be able check the status of your PNR on airline website or call center but names will be update 12 to 24 hrs prior to the flight departure.</strong></p></li>
                <li><b>&bull;</b><p>Web check-in is mandatory to board flights.</p></li>
            </ol>
           
            <div class="Enablebtn" style="display:block;">
                <div class="popupbtn">
                    <button class="closepopup" onclick="close();" >Close</button>
                    <button class="acceptBtn" type="submit" id="btnSubmit_Payment" onclick="return payOnline();">I Accept</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DisplaySessionTimeout" class="SessionTimeOut">
    <div class="sessionbox">
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-3"></div>
                <div class=" session-exp no_padding">
                    <h2 class="session-head"> Session expired</h2>
                    <div class="session_content">
                        <h3 class="text-center t-color2"><i class="fa fa-clock-o"></i>Your Session has expired</h3><br />
                        <p class="text-center session-color">
                            Your preferred search session has expired. We regret the inconvenience caused
                        </p><br />
                        <div class="col-md-6  col-xs-6"><p class="session-2"><a href="/" class="search-button-01 se-05">Go to Home</a></p></div>
                        <div class="col-md-6  col-xs-6 pull-right"><p class="sessionP"><a class="search-button-02" href="@Model.deepLink">Search Again</a></p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




@section scripts {
    @Scripts.Render("~/bundles/mojoFlightIndiaPassenger")
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        $(document).ready(function(){
            if((@ViewBag.IsBookingCompleted==null?false:@(Convert.ToBoolean(ViewBag.IsBookingCompleted))))
            {
                window.location.replace("/flight/FlightConfirmation/" + @Model.userSearchID);
            }
        });

      
    </script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>
        var timer2 = "14 min:59 sec";
        var interval = setInterval(function() {
            var timer = timer2.split(':');
            var minutes = parseInt(timer[0], 10);
            var seconds = parseInt(timer[1], 10);
            --seconds;
            minutes = (seconds < 0) ? --minutes : minutes;
            if (minutes < 0) clearInterval(interval);
            seconds = (seconds < 0) ? 59 : seconds;
            seconds = (seconds < 10) ? '0' + seconds : seconds;
            $('.countdown').html(minutes + ' min' +  ' : '  + seconds + ' sec' +' left');
         
            timer2 = minutes + ':' + seconds;
        }, 1000);

</script>


    <script>
        function close()
        {
            $("#GrpFare").hide();
        }

        function ShowGroupFare()
        {
            $("#GrpFare").show();
        }
        $(document).ready(function () {
            $(".close_group").click(function () {
                $("#GrpFare").hide();
            });
            $(".closepopup").click(function () {
                $("#GrpFare").hide();
            });
        });

    </script>

    <script>
        function payOnline() {
            var jsonData = {
                mode: $('[name="payment"]:radio:checked').val(),
                ID: '@Model.userSearchID',
            };
            $.ajax({
                type: "POST",
                url: "/Flight/details",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(jsonData),
                responseType: "json",
                success: function (r) {
                    if (r.status == 2) {
                        Swal.fire({
                            type: 'error',
                            title: r.name,
                            text: 'Oops...'
                        })
                    }
                    else if (r.status == 0) {
                        Swal.fire({
                            type: 'error',
                            title: 'Something went wrong please try after some time ....!',
                            text: 'Oops...'
                        })
                    }
                    else
                        var options = {
                            "key": "@GlobalData.key",
                            "amount": r.amount,
                            "name": "FLIGHTS MOJO BOOKINGS PRIVATE LIMITED",
                            "payment_capture": "1",
                            "order_id": r.orderid,
                            "amount_refunded": 0,
                            "refund_status": null,
                            "captured": true,
                            "description": @Model.bookingID,
                            "image": "https://www.flightsmojo.in/images/logo.png",
                            "config": {
                                "display": {
                                    "blocks": {
                                        "banks": {
                                            "name": 'FLIGHTS MOJO BOOKINGS PRIVATE LIMITED',
                                            "instruments": [
                                                { "method": $('[name="payment"]:radio:checked').val() },
                                            ],
                                        },
                                    },
                                    sequence: ['block.banks'],
                                    preferences: {
                                        show_default_blocks: false,
                                    },
                                },
                            },
                            "handler": function (response) {
                                $("#paymentid").val(response.razorpay_payment_id);
                                $("#signature").val(response.razorpay_signature);
                                $("#orderID").val(response.razorpay_order_id);
                                $("#searchID").val('@Model.userSearchID');
								$('form#Payment').submit();
                                $('#ResultProgressPopup').show();
                                $("#GrpFare").hide();
                            },

                            "prefill": {
                                "name": r.name,
                                "email": r.email,
                                "contact": r.phone
                            },
                            "notes": {
                                "address": r.address
                            },
                            "theme": {
                                "color": "#F37254"
                            }
                        };
                    var rzp1 = new Razorpay(options);
                    rzp1.open();
                    $("#GrpFare").hide();
                    event.preventDefault();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    alert("Status: " + textStatus); alert("Error: " + errorThrown);
                }
            });
        }
    </script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <script type="text/javascript">
        $(window).scroll(function () {
            var scroll = $(window).scrollTop();
            if (scroll >= 140) {
                $(".payment_right").addClass("fixed-right");
            } else {
                $(".payment_right").removeClass("fixed-right");
            }
        });
        function ChangeCardType(tpe) {
            $("#CareType").val(CareType);
        }
        function ShowProPopup() {
            $('.main_modal').toggleClass('is-visible');
        }


        $('.payI').on('click', function () {
            $('.payment_It').fadeToggle("slow");
        });
    </script>
    <script>
        function update_payment() {
            var payment_mode = $('input[name="payment"]:checked').val();
            var S_media=@Model.sourceMedia;
            if(S_media=="1013")
            {
                if (payment_mode == "netbanking") {
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    $("#CFee").hide();
                    $("#ConvenienceFee").hide();

                    $("#tot").html(+final_pay.toFixed(0));
                    $("#totA").html(+final_pay.toFixed(0));
                    $("#totMobile").html(+final_pay.toFixed(0));
                   
                }
                else {
                    $("#CFee").show();
                    $("#ConvenienceFee").show();
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    var final_con = parseFloat($("#conveniencefee").val());
                    var final = final_pay + final_con;
                    $("#tot").html(+final.toFixed(0));
                    $("#totA").html(+final.toFixed(0));
                    $("#totMobile").html(+final.toFixed(0));
                }
            }
            else if(S_media=="1015" ||S_media=="1001")
            {
                if (payment_mode == "upi") {
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    $("#CFee").hide();
                    $("#CFeeUPI").hide();
                    $("#ConvenienceFee").hide();
                    $("#ConvenienceFeeUPI").hide();

                    var final_pay = parseFloat($("#hftotalAmt").val());
                    //var final_con = parseFloat($("#conveniencefeeUPI").val());
                    var final_con = parseFloat(0);
                    var final = final_pay + final_con;
                   
                    $("#tot").html(+final.toFixed(0));
                    $("#totA").html(+final.toFixed(0));
                    $("#totMobile").html(+final.toFixed(0));
                }
                else {
                    $("#CFee").show();
                    $("#CFeeUPI").hide();
                    $("#ConvenienceFee").show();
                    $("#ConvenienceFeeUPI").hide();
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    var final_con = parseFloat($("#conveniencefee").val());
                    var final = final_pay + final_con;
                    $("#tot").html(+final.toFixed(0));
                    $("#totA").html(+final.toFixed(0));
                    $("#totMobile").html(+final.toFixed(0));
                }
            }
            else
            {
                if (payment_mode == "upi") {
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    $("#CFee").hide();
                    $("#CFeeUPI").show();
                    $("#ConvenienceFee").hide();
                    $("#ConvenienceFeeUPI").show();

                    var final_pay = parseFloat($("#hftotalAmt").val());
                    var final_con = parseFloat($("#conveniencefeeUPI").val());
                    var final = final_pay + final_con;
                   
                    $("#tot").html(+final.toFixed(0));
                    $("#totA").html(+final.toFixed(0));
                    $("#totMobile").html(+final.toFixed(0));
                }
                else {
                    $("#CFee").show();
                    $("#CFeeUPI").hide();
                    $("#ConvenienceFee").show();
                    $("#ConvenienceFeeUPI").hide();
                    var final_pay = parseFloat($("#hftotalAmt").val());
                    var final_con = parseFloat($("#conveniencefee").val());
                    var final = final_pay + final_con;
                    $("#tot").html(+final.toFixed(0));
                    $("#totA").html(+final.toFixed(0));
                    $("#totMobile").html(+final.toFixed(0));
                }
            }
        }
    </script>

    <script>
        $(document).ready(function () {
            update_payment();
            $(document).on('change', 'input[name="payment"]', function (e) {
                update_payment();
            });
        });
    </script>
}

